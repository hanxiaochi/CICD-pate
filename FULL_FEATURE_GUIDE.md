# CICD系统完整功能使用指南

## 🎯 系统概览

CICD系统提供两种运行模式：

### 🚀 完整版模式（推荐）
包含全部CICD功能，适合正式使用：
- 📂 **工作空间管理** - 团队协作的基础单元
- 📁 **项目管理** - 代码仓库和构建配置
- 💻 **资产管理** - 服务器、容器等基础设施
- 👥 **用户管理** - 权限控制和团队成员管理
- 📊 **系统监控** - 实时状态和性能监控
- 🔌 **API接口** - 完整的REST API

### ⚡ 简化版模式
仅包含基础功能，启动速度快，适合快速测试：
- 🔐 用户登录认证
- 📊 基础系统状态
- 🔌 基础API接口

## 🔄 模式切换

### 在云服务器上切换模式
```bash
# 下载并运行模式切换脚本
curl -fsSL https://xget.xi-xu.me/gh/hanxiaochi/CICD-pate/raw/master/switch_mode.sh -o switch_mode.sh
chmod +x switch_mode.sh
./switch_mode.sh
```

### 手动切换到完整版
```bash
# 停止当前容器
docker-compose down

# 设置完整版模式
export CICD_MODE=full

# 启动完整版
docker-compose up --build -d
```

### 手动切换到简化版
```bash
# 停止当前容器
docker-compose down

# 设置简化版模式
export CICD_MODE=simple

# 启动简化版
docker-compose up --build -d
```

## 📂 完整版功能详解

### 1. 工作空间管理 (/workspaces)

工作空间是团队协作的基础单元，每个工作空间可以包含多个项目。

**主要功能：**
- 创建/编辑/删除工作空间
- 工作空间成员管理
- 权限设置
- 资源配额管理

**使用流程：**
1. 访问 `/workspaces` 查看所有工作空间
2. 点击"新建工作空间"创建
3. 配置工作空间基本信息和权限
4. 添加团队成员
5. 开始在工作空间中创建项目

### 2. 项目管理 (/projects)

项目是具体的代码仓库和构建配置的集合。

**主要功能：**
- 项目创建和配置
- Git仓库集成
- 构建流水线配置
- 部署环境管理
- 构建历史查看

**使用流程：**
1. 访问 `/projects` 查看所有项目
2. 点击"新建项目"
3. 配置项目基本信息：
   - 项目名称和描述
   - Git仓库地址
   - 选择所属工作空间
   - 设置构建触发条件
4. 配置构建流水线
5. 设置部署环境
6. 触发构建和部署

### 3. 资产管理 (/assets)

管理构建和部署所需的基础设施资源。

**主要功能：**
- 服务器资源管理
- Docker容器管理
- 网络配置
- 存储管理
- 监控告警

**资源类型：**
- **物理机器** - 传统服务器
- **虚拟机** - 云主机实例
- **容器** - Docker容器
- **集群** - Kubernetes集群

### 4. 用户管理 (/users)

用户账户和权限管理系统。

**角色类型：**
- **管理员(admin)** - 系统全权限
- **项目经理(manager)** - 工作空间管理权限
- **开发者(developer)** - 项目开发权限
- **访客(guest)** - 只读权限

**权限控制：**
- 工作空间级别权限
- 项目级别权限
- 资源访问权限
- API调用权限

### 5. 系统监控 (/monitor)

实时监控系统状态和性能指标。

**监控内容：**
- 系统资源使用率
- 构建队列状态
- 部署成功率
- API响应时间
- 错误日志统计

## 🚀 快速开始工作流程

### 第一次使用 - 管理员设置
1. **登录系统** (admin/admin123)
2. **创建工作空间**
   - 访问 `/workspaces` 
   - 点击"新建工作空间"
   - 设置工作空间名称和描述
3. **添加团队成员**
   - 在工作空间详情页添加成员
   - 分配适当的角色权限
4. **配置资产资源**
   - 访问 `/assets`
   - 添加服务器或容器资源
   - 配置网络和存储

### 开发者工作流程
1. **查看可访问的工作空间**
   - 登录后查看 `/workspaces`
2. **创建新项目**
   - 在工作空间中点击"新建项目"
   - 配置Git仓库和构建设置
3. **配置构建流水线**
   - 设置构建脚本
   - 配置测试步骤
   - 设置部署目标
4. **触发构建**
   - 推送代码自动触发
   - 或手动触发构建
5. **监控构建状态**
   - 查看构建日志
   - 检查部署结果

## 🔌 API接口使用

### 认证
所有API调用都需要先登录获取会话。

```bash
# 登录获取会话
curl -X POST http://localhost:4567/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### 主要API端点

#### 系统信息
```bash
# 健康检查
curl http://localhost:4567/api/health

# 版本信息
curl http://localhost:4567/api/version

# 系统统计
curl http://localhost:4567/api/stats
```

#### 工作空间管理
```bash
# 获取工作空间列表
curl http://localhost:4567/api/workspaces

# 创建工作空间
curl -X POST http://localhost:4567/api/workspaces \
  -H "Content-Type: application/json" \
  -d '{"name":"我的工作空间","description":"描述"}'

# 获取工作空间详情
curl http://localhost:4567/api/workspaces/1
```

#### 项目管理
```bash
# 获取项目列表
curl http://localhost:4567/api/projects

# 创建项目
curl -X POST http://localhost:4567/api/projects \
  -H "Content-Type: application/json" \
  -d '{"name":"我的项目","repo_url":"https://github.com/user/repo.git"}'
```

## 🛠️ 故障排除

### 常见问题

#### 1. 工作空间页面访问404
**原因：** 当前运行的是简化版模式
**解决：** 切换到完整版模式
```bash
./switch_mode.sh  # 选择选项1
```

#### 2. 项目创建失败
**原因：** 权限不足或工作空间未选择
**解决：** 
- 检查当前用户权限
- 确保已选择正确的工作空间
- 检查Git仓库地址格式

#### 3. 构建失败
**原因：** 资产资源配置错误或构建脚本问题
**解决：**
- 检查资产资源状态
- 验证构建脚本语法
- 查看详细构建日志

#### 4. 无法访问某些功能
**原因：** 用户权限不足
**解决：**
- 联系管理员分配权限
- 检查工作空间成员设置

### 系统状态检查
```bash
# 检查容器状态
docker-compose ps

# 查看系统日志
docker-compose logs -f

# 检查当前运行模式
./switch_mode.sh  # 选择选项3
```

## 📈 最佳实践

### 1. 工作空间规划
- 按团队或产品线划分工作空间
- 合理设置成员权限
- 定期清理无用资源

### 2. 项目管理
- 使用清晰的项目命名规范
- 配置合理的构建触发条件
- 定期备份重要项目配置

### 3. 资产管理
- 标准化服务器配置
- 实施资源监控告警
- 定期进行资源清理

### 4. 安全建议
- 定期更换默认密码
- 使用最小权限原则
- 启用操作日志审计

---

**🎉 现在您可以充分利用CICD系统的完整功能进行团队协作和项目管理了！**

如有任何问题，请查看系统日志或联系管理员。