!!!
%html{:lang => "zh-CN"}
  %head
    %meta{:charset => "utf-8"}/
    %meta{:content => "width=device-width, initial-scale=1", :name => "viewport"}/
    %title 新建构建 - CICD系统
    %link{:href => "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css", :rel => "stylesheet"}/
    %link{:href => "https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css", :rel => "stylesheet"}/
    :css
      body {
        font-size: .875rem;
        background-color: #f6f8fa;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
        line-height: 1.5;
        color: #24292e;
      }

      .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        z-index: 100;
        padding: 56px 0 0;
        background-color: #ffffff;
        transition: all 0.3s ease;
        width: 240px;
        border-right: 1px solid #e1e4e8;
      }

      .sidebar.collapsed {
        width: 60px !important;
      }

      .sidebar.collapsed .sidebar-text {
        display: none;
      }

      .sidebar.collapsed .sidebar-icon {
        margin-right: 0;
      }

      .sidebar-heading {
        font-size: .75rem;
        text-transform: uppercase;
        color: #6c757d;
        padding: 10px 15px;
        font-weight: 600;
      }

      .sidebar-link {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        text-decoration: none;
        color: #24292e;
        transition: all 0.2s;
        font-size: 14px;
      }

      .sidebar-link:hover {
        background-color: #f6f8fa;
        color: #0969da;
      }

      .sidebar-link.active {
        background-color: #f6f8fa;
        color: #0969da;
        font-weight: 600;
      }

      .sidebar-icon {
        margin-right: 12px;
        font-size: 16px;
        width: 16px;
        text-align: center;
      }

      .main-content {
        margin-left: 240px;
        transition: margin-left 0.3s ease;
      }

      .header {
        position: fixed;
        top: 0;
        right: 0;
        left: 240px;
        z-index: 99;
        background-color: #ffffff;
        border-bottom: 1px solid #e1e4e8;
        padding: 8px 16px;
        display: flex;
        align-items: center;
        transition: left 0.3s ease;
      }

      .sidebar-toggle {
        background: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #57606a;
        padding: 4px;
        border-radius: 4px;
      }

      .sidebar-toggle:hover {
        background-color: #f6f8fa;
      }

      .header-bar {
        background-color: #ffffff;
        border-bottom: 1px solid #e1e4e8;
        padding: 16px 0;
        margin-bottom: 24px;
        margin-top: 56px;
      }

      .form-container {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        border: 1px solid #e1e4e8;
        margin-bottom: 2rem;
      }

      .form-label {
        font-weight: 600;
        margin-bottom: 8px;
      }

      .form-control, .form-select {
        border: 1px solid #e1e4e8;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 14px;
      }

      .form-control:focus, .form-select:focus {
        outline: none;
        border-color: #0969da;
        box-shadow: 0 0 0 2px rgba(9, 105, 218, 0.2);
      }

      .btn-primary {
        background-color: #0969da;
        border-color: #0969da;
      }

      .btn-primary:hover {
        background-color: #0759c4;
        border-color: #0759c4;
      }

      .required::after {
        content: " *";
        color: #cf222e;
      }

  %body
    .header
      %button#sidebarToggle.sidebar-toggle
        %i.bi.bi-list
      .flex-grow-1
      .dropdown
        %button.btn.btn-sm.btn-outline-secondary.dropdown-toggle{"data-bs-toggle" => "dropdown"}
          %i.bi.bi-person-circle.me-1
          = current_user.username
        .dropdown-menu.dropdown-menu-end
          %a.dropdown-item{:href => "/"}
            %i.bi.bi-speedometer2.me-2
            仪表板
          %a.dropdown-item{:href => "/logout"}
            %i.bi.bi-box-arrow-right.me-2
            退出登录

    .container-fluid
      .row
        %nav#sidebar.sidebar
          .sidebar-sticky
            %ul.nav.flex-column
              %li.nav-item
                %a.nav-link.sidebar-link{:href => "/"}
                  %i.bi.bi-speedometer2.sidebar-icon
                  %span.sidebar-text 仪表板
              %li.nav-item
                %a.nav-link.sidebar-link{:href => "/projects"}
                  %i.bi.bi-folder.sidebar-icon
                  %span.sidebar-text 项目管理
              %li.nav-item
                %a.nav-link.sidebar-link.active{:href => "/builds"}
                  %i.bi.bi-hammer.sidebar-icon
                  %span.sidebar-text 构建管理
              %li.nav-item
                %a.nav-link.sidebar-link{:href => "/resources"}
                  %i.bi.bi-server.sidebar-icon
                  %span.sidebar-text 资源管理
              %li.nav-item
                %a.nav-link.sidebar-link{:href => "/scripts"}
                  %i.bi.bi-file-text.sidebar-icon
                  %span.sidebar-text 脚本管理
              %li.nav-item
                %a.nav-link.sidebar-link{:href => "/plugins"}
                  %i.bi.bi-plug.sidebar-icon
                  %span.sidebar-text 插件管理
              %li.nav-item
                %a.nav-link.sidebar-link{:href => "/workspaces"}
                  %i.bi.bi-archive.sidebar-icon
                  %span.sidebar-text 工作空间
              %li.nav-item
                %a.nav-link.sidebar-link{:href => "/system"}
                  %i.bi.bi-gear.sidebar-icon
                  %span.sidebar-text 系统管理

        %main.main-content.col-md-9.ml-sm-auto.col-lg-10.px-md-4
          .header-bar
            .container
              .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
                %h1.h2 新建构建

          .container
            .form-container
              %form{:action => "/builds", :method => "post"}
                .mb-3
                  %label.form-label.required 项目
                  %select.form-select{:name => "project_id", :required => "required"}
                    %option{:value => ""} 选择项目
                    - if @projects
                      - @projects.each do |project|
                        %option{:value => project.id}= project.name

                .mb-3
                  %label.form-label 分支
                  %input.form-control{:type => "text", :name => "branch", :placeholder => "例如: main, develop", :value => "main"}

                .mb-3
                  %label.form-label 提交哈希
                  %input.form-control{:type => "text", :name => "commit_hash", :placeholder => "可选，留空则使用最新提交"}

                .mb-3
                  %label.form-label 状态
                  %select.form-select{:name => "status"}
                    %option{:value => "pending"} 等待中
                    %option{:value => "running"} 运行中
                    %option{:value => "success"} 成功
                    %option{:value => "failed"} 失败

                .d-grid.gap-2.d-md-flex.justify-content-md-end
                  %a.btn.btn-secondary.me-md-2{:href => "/builds"} 取消
                  %button.btn.btn-primary{:type => "submit"}
                    %i.bi.bi-plus-lg.me-1
                    创建构建

    %script{:src => "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"}
    :javascript
      document.addEventListener('DOMContentLoaded', function() {
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const mainContent = document.querySelector('.main-content');
        const header = document.querySelector('.header');
        
        sidebarToggle.addEventListener('click', function() {
          sidebar.classList.toggle('collapsed');
          if (sidebar.classList.contains('collapsed')) {
            mainContent.style.marginLeft = '60px';
            header.style.left = '60px';
            sidebarToggle.innerHTML = '<i class="bi bi-list"></i>';
          } else {
            mainContent.style.marginLeft = '240px';
            header.style.left = '240px';
            sidebarToggle.innerHTML = '<i class="bi bi-list"></i>';
          }
        });
      });