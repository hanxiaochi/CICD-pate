# CICD自动化部署工具

这是一个基于Ruby和Sinatra开发的CICD自动化部署工具，旨在简化项目的构建、部署、备份和回滚流程，无需编写复杂的脚本。

## 功能特性

- **多代码仓库支持**：支持Git和SVN两种代码仓库类型
- **可视化部署**：通过Web界面填写部署信息，无需编写复杂脚本
- **自动备份**：部署前自动备份当前版本
- **版本回滚**：可以选择历史备份进行一键回滚
- **部署历史**：记录所有部署操作，方便追踪问题
- **用户认证**：支持基本的用户登录和权限控制
- **响应式设计**：适配各种设备的屏幕尺寸

## 技术栈

- Ruby
- Sinatra (Web框架)
- Haml (模板引擎)
- SQLite (数据库)
- Sequel (ORM)
- Git/SVN (代码仓库)
- SSH/SFTP (远程部署)

## 安装说明

### 前提条件

- 安装Ruby 2.5+ 环境
- 确保系统已安装Git和SVN客户端
- 目标服务器需开启SSH服务

### 安装步骤

1. 克隆或下载本项目到本地

2. 安装依赖：

```bash
cd 项目目录
bundle install
```

3. 启动应用：

```bash
ruby app.rb
# 或使用shotgun进行开发模式
shotgun app.rb -p 4567
```

4. 打开浏览器访问 http://localhost:4567

5. 使用默认管理员账号登录：
   - 用户名：admin
   - 密码：admin123
   - 请登录后及时修改密码

## 使用指南

### 创建项目

1. 点击"新建项目"按钮
2. 填写项目基本信息：
   - 项目名称：唯一标识
   - 代码仓库类型：选择Git或SVN
   - 代码仓库地址：完整的仓库URL
   - 分支：代码分支（默认为master）
3. 配置构建信息：
   - 构建脚本：如 `npm install && npm run build`
   - 构建产物路径：如 `dist/app.tar.gz`
4. 配置部署信息：
   - 部署服务器：格式为 `user@host:port`（默认为root用户和22端口）
   - 部署目录：目标服务器上的目录路径
   - 启动脚本：如 `systemctl restart myapp`
5. 配置备份信息：
   - 备份目录：用于存储备份文件的目录

### 部署项目

1. 在项目列表中，点击对应项目的"部署"按钮
2. 确认项目信息无误后，点击"确认部署"按钮
3. 系统将自动执行以下操作：
   - 克隆代码仓库
   - 执行构建脚本
   - 在目标服务器上创建备份（如果配置了备份目录）
   - 上传构建产物到目标服务器
   - 执行启动脚本

### 管理备份和回滚

1. 在项目列表中，点击对应项目的"备份管理"按钮
2. 查看所有可用的备份文件及其创建时间
3. 选择需要回滚的备份，点击"回滚到此版本"按钮
4. 系统将自动执行回滚操作

### 查看部署历史

1. 在项目列表中，点击对应项目的"部署历史"按钮
2. 查看所有部署记录，包括版本号、状态、部署用户和时间
3. 点击"查看详情"可查看具体的部署日志

## 注意事项

1. 首次使用请修改管理员密码
2. 确保目标服务器的SSH服务可用，并且已配置正确的访问权限
3. 备份目录需要有写入权限
4. 对于大型项目，可能需要调整临时目录的存储空间
5. 在生产环境中，建议使用更安全的数据库和用户认证方式

## 开发说明

1. 如需添加新功能，请遵循现有代码结构
2. 视图文件位于`views/`目录下
3. 静态资源位于`public/`目录下
4. 数据库模型在`app.rb`文件中定义

## License

[MIT](https://opensource.org/licenses/MIT)